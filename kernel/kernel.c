#include <stdint.h>
#include <printk.h>
#include <descriptor_tables.h>
#include <timer.h>
#include <drivers/keyboard/ps2.h>
#include <isr.h>

void kernel_main() {

    cls();

    char kawaii[] = {
        0x20,0x5f,0x20,0x20,0x20,0x5f,0x5f,0x20,0x20,0x20,
        0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
        0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x5f,0x20,0x5f,
        0x20,0x5f,0x5f,0x5f,0x5f,0x5f,0x20,0x5f,0x5f,0x5f,
        0x5f,0x5f,0x20,0xa,0x7c,0x20,0x7c,0x20,0x2f,0x20,
        0x2f,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
        0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
        0x28,0x5f,0x7c,0x5f,0x29,0x20,0x20,0x5f,0x20,0x20,
        0x2f,0x20,0x20,0x5f,0x5f,0x5f,0x7c,0xa,0x7c,0x20,
        0x7c,0x2f,0x20,0x2f,0x20,0x20,0x5f,0x5f,0x20,0x5f,
        0x5f,0x5f,0x20,0x20,0x20,0x20,0x20,0x20,0x5f,0x5f,
        0x5f,0x5f,0x20,0x5f,0x20,0x5f,0x20,0x5f,0x7c,0x20,
        0x7c,0x20,0x7c,0x20,0x5c,0x20,0x60,0x2d,0x2d,0x2e,
        0x20,0xa,0x7c,0x20,0x20,0x20,0x20,0x5c,0x20,0x2f,
        0x20,0x5f,0x60,0x20,0x5c,0x20,0x5c,0x20,0x2f,0x5c,
        0x20,0x2f,0x20,0x2f,0x20,0x5f,0x60,0x20,0x7c,0x20,
        0x7c,0x20,0x7c,0x20,0x7c,0x20,0x7c,0x20,0x7c,0x60,
        0x2d,0x2d,0x2e,0x20,0x5c,0xa,0x7c,0x20,0x7c,0x5c,
        0x20,0x20,0x5c,0x20,0x28,0x5f,0x7c,0x20,0x7c,0x5c,
        0x20,0x56,0x20,0x20,0x56,0x20,0x2f,0x20,0x28,0x5f,
        0x7c,0x20,0x7c,0x20,0x7c,0x20,0x5c,0x20,0x5c,0x5f,
        0x2f,0x20,0x2f,0x5c,0x5f,0x5f,0x2f,0x20,0x2f,0xa,
        0x5c,0x5f,0x7c,0x20,0x5c,0x5f,0x2f,0x5c,0x5f,0x5f,
        0x2c,0x5f,0x7c,0x20,0x5c,0x5f,0x2f,0x5c,0x5f,0x2f,
        0x20,0x5c,0x5f,0x5f,0x2c,0x5f,0x7c,0x5f,0x7c,0x5f,
        0x7c,0x5c,0x5f,0x5f,0x5f,0x2f,0x5c,0x5f,0x5f,0x5f,
        0x5f,0x2f,0x20,0xa,0x20,0x20,0x20,0x20,0x20,0x20,
        0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
        0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
        0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
        0x20,0x20,0x20,0x20,0x20,0x20,0x20,0xa,0x20,0x20,
        0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
        0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
        0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
        0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
        0x20,0xa,0x0
        };
    printk(kawaii);
    
    printk("the educational operating system.\n");
    printk("By Ahmed Khaled <nemoload@aol.com>\n");
    
    char *source_code = "https://github.com/nemoload/KawaiiOS\n";
    printk("Source code is at: %s\n\n",source_code);

    init_descriptor_tables();

    char *gdt = "[*] Global Descriptor Table updated\n";
    printk(gdt);
    // char *idt = "[*] Interrupt Descriptor Table crated\n";
    // printk(idt);


    keyboard_init();
    char *ps2 = "[*] PS/2 driver is ready\n";
    printk(ps2);

    asm ("sti");
 
    // uint16_t freq = 44000;
    // init_timer(freq);
    // uint8_t mask = 4;
    // outb(0x60,0xED|mask);
}